<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>신나는 야구시합</title>
</head>
<style>
    input[type="radio"] {display: none}
    input[type="radio"]+label {display: inline-block; padding: 20px; cursor: pointer}
    input[type="radio"]:checked+label {background: rgb(156, 204, 79); color: #000}
    .conbox {width: 1000px; height: 600px; display: none}
    input[id="tab01"]:checked~.con1 {display: block}
    input[id="tab02"]:checked~.con2 {display: block}
    input[id="tab03"]:checked~.con3 {display: block}
    button {
        font-size: 15px;
        margin: 20px;
    }
</style>
<div class="tab_content">
    <input type="radio" name="tabmenu" id="tab01" checked>
    <label for="tab01">1. 데이터 입력</label>
    <input type="radio" name="tabmenu" id="tab02">
    <label for="tab02">2. 데이터 출력</label>
    <input type="radio" name="tabmenu" id="tab03">
    <label for="tab03">3. 게임 시작</label>

    <div class="conbox con1">
        <button onclick="input()">데이터 입력 시작</button><br><br>
        <div id="complete"></div>
    </div>
    <div class="conbox con2">
        <button onclick="output()">데이터 결과 보기</button><br><br>
        <div id="output"></div>
    </div>
    <div class="conbox con3">
        <button onclick="runGame()">게임 시작</button>
    </div>
</div>

<body>
    <script>
        var teamA = {};
        var teamB = {};

        function inputName(team) {
            while (true) {
                if (team === teamA) {
                    var i = 1;
                } else {
                    i = 2;
                }
                var str1 = prompt(i + "팀의 이름을 입력하세요");
                if (str1.length != 0) {
                    team.name = str1;
                    break;
                } else {
                    alert("에러! 다시입력하세요");
                }
            } return team;
        }
        
        function inputplayer(team) {
            for (var i = 1; i <= 9; i++) {
                while (true) {
                    var str = prompt(i + "번 타자 정보 입력 \n 형식 : 이름, 타율 (단, 타율은 0.1과 0.5 사이이고, 소수 셋째자리까지 입력)");
                    if (str.indexOf(",") != -1) {
                        var check = str.split(", ");
                        if (Number(check[1]) > 0.1 & Number(check[1]) < 0.5 & check[1].length === 5) {
                            team[i] = check;
                            team[i].unshift(i + "번");
                            break;
                        } else {
                            alert("에러! 조건에 맞게 다시 입력하세요");
                        }
                    } else {
                        alert("에러! 조건에 맞게 다시 입력하세요");
                    }
                }
            } return team;
        }

        function input() {
            inputName(teamA);
            inputplayer(teamA);
            inputName(teamB)
            inputplayer(teamB);
            document.getElementById("complete").innerHTML = "팀 데이터 입력이 완료되었습니다.";
            return { teamA, teamB };
        }

        function outputplayer(team) {
            for (var i = 1; i <= 9; i++) {
                console.log(team[i][0] + " " + team[i][1] + " " + team[i][2]);
            }
        }

        function output() {
            console.log(teamA.name + " 팀 정보");
            outputplayer(teamA);
            console.log("");
            console.log(teamB.name + " 팀 정보");
            outputplayer(teamB);
            console.log("");
            document.getElementById("output").innerHTML = "* 출력 결과는 콘솔창에 나타납니다."
        }

        function getRandomscore(team) {
            for (var i = 1; i <= 9; i++) {
                var random = Math.random().toFixed(3);
                var h = Number(team[i][2]);
                if (random <= h) {
                    team[i][3] = "H";
                } else if (random > h & random <= (h + (1 - h) / 2 - 0.05)) {
                    team[i][3] = "S";
                } else if (random >= 0.900) {
                    team[i][3] = "O";
                } else {
                    team[i][3] = "B";
                }
            } return team;
        }

        teamA.score = [];
        teamB.score = [];

        var count_S = 0; var count_B = 0; var count_H = 0; var count_O = 0; var count_score = 0;
        var pre_O; var pre_H;

        function getStrike() {
            count_S += 1;
            pre_H = count_H;
            pre_O = count_O;
            if (count_S === 3) {
                pre_H = count_H;
                pre_O = count_O;
                count_O += 1;
                count_S = 0;
            } return [count_S, count_B, count_H, count_O];
        }

        function getBall() {
            count_B += 1;
            pre_H = count_H;
            pre_O = count_O;
            if (count_B === 4) {
                pre_H = count_H;
                pre_O = count_O;
                count_H += 1;
                count_B = 0;
            } return [count_S, count_B, count_H, count_O];
        }

        function getHit() {
            pre_H = count_H;
            pre_O = count_O;
            count_H += 1;
            count_S = 0;
            count_B = 0;
            if (count_H >= 4) {
                count_score += 1;
            }
            return [count_S, count_B, count_H, count_O];
        }

        function getOut() {
            pre_H = count_H;
            pre_O = count_O;
            count_O += 1;
            count_S = 0;
            count_B = 0;
            return [count_S, count_B, count_H, count_O];
        }

        function record(score, count_score) {
            if (score === "S") {
                getStrike();
                document.write("스트라이크!<br>"+ count_S + "S " + count_B + "B " + count_O + "O<br><br>");
            } else if (score === "B") {
                getBall();
                document.write("볼!<br>" + count_S + "S " + count_B + "B " + count_O + "O<br><br>");
            } else if (score === "H") {
                getHit();
                document.write("안타!<br>" + count_S + "S " + count_B + "B " + count_O + "O<br><br>");
            } else {
                getOut();
                document.write("아웃!<br>" + count_S + "S " + count_B + "B " + count_O + "O<br><br>");
            }
        }

        function game(n, team) {
            if (team === "teamA") {
                var time = "회초 ";
            } else {
                time = "회말 ";
            }
            document.write(n + time + team.name + " 공격<br><br>");
            var i = 1;
            while (count_O < 3) {
                var team_input = getRandomscore(team)
                var score = team_input[i][3];
                document.write(team[i][0] + " " + team[i][1] + "<br>");
                record(score, count_score);
                if (count_O != pre_O || count_H != pre_H) {
                    i += 1;
                    if (i === 10) {
                        i = 1;
                    }
                }
            }
            count_S = 0; count_B = 0; count_H = 0; count_O = 0; team.score.push(count_score);
            count_score = 0;
        }
    </script>
</body>
</html>